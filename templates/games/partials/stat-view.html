
<!-- Readonly Stats Viewer -->
<section
    class="card bg-base-100 shadow-lg"
    x-show="latestGameData"
    x-cloak
>
    <div class="card-body">
        <div class="flex items-center justify-between mb-4">
            <h2 class="card-title">Statistics</h2>
            <p class="text-sm text-base-content/60" x-text="currentSetScoreText"></p>
        </div>

        <!-- Tabs -->
        <div class="tabs tabs-bordered mb-4">
            <template x-for="(label, idx) in setLabels" :key="idx">
                <button
                    type="button"
                    class="tab"
                    :class="activeSetIndex === idx ? 'tab-active' : ''"
                    @click="setActiveSet(idx)"
                >
                    <span x-text="label"></span>
                </button>
            </template>

            <div class="divider divider-horizontal"></div>

            <template x-for="team in teams" :key="team.key">
                <button
                    type="button"
                    class="tab"
                    :class="activeTeamKey===team.key ? 'tab-active' : ''"
                    @click="activeTeamKey=team.key"
                >
                    <span x-text="team.label"></span>
                </button>
            </template>
        </div>

        <!-- Stats Table -->
        <div class="overflow-x-auto">
            <div
                x-show="getCurrentStatsEntries().length === 0"
                class="text-base-content/60"
            >
                No stats available for the selected set/team.
            </div>
            <table
                x-show="getCurrentStatsEntries().length > 0"
                class="table table-zebra w-full"
            >
                <thead>
                <tr>
                    <th>Player #</th>
                    <th>Kills</th>
                    <th>Sets</th>
                    <th>Blocks</th>
                    <th>Digs</th>
                    <th>Aces</th>
                    <th>Missed Serves</th>
                    <th>Errors</th>
                </tr>
                </thead>
                <tbody>
                <template
                    x-for="[num, stats] in getCurrentStatsEntries()"
                    :key="num"
                >
                    <tr>
                        <!-- Player number -->
                        <td class="font-semibold" x-text="num"></td>

                        <!-- Kills -->
                        <td>
                            <div>
                                <span x-text="stats.kills.length"></span>
                            </div>
                            <!-- Distribution -->
                            <div class="mt-1 text-xs text-base-content/70">
                                <template x-for="[pos, count] in stats.killDistribution" :key="pos">
                                    <div x-show="count > 0">
                                        → Pos <span x-text="pos"></span>: <span x-text="count"></span>
                                    </div>
                                </template>
                            </div>
                        </td>

                        <!-- Sets -->
                        <td>
                            <div>
                                <span x-text="stats.sets.length"></span>
                            </div>
                            <!-- Mini from→to matrix -->
                            <div class="mt-1 text-xs grid grid-cols-3 gap-1">
                                <template x-for="item in stats.setMatrix" :key="item.from + '-' + item.to">
                                    <div x-show="item.count > 0"
                                         class="badge badge-outline">
                                        <span x-text="'['+item.from+'→'+item.to+']'"></span>:
                                        <span x-text="item.count"></span>
                                    </div>
                                </template>
                            </div>
                        </td>

                        <!-- Other stats -->
                        <td x-text="stats.blocks"></td>
                        <td x-text="stats.digs"></td>
                        <td x-text="stats.aces"></td>
                        <td x-text="stats.missed_serves"></td>
                        <td x-text="stats.errors"></td>
                    </tr>
                </template>
                </tbody>
            </table>
        </div>
    </div>
</section>
